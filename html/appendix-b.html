<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>附录B：倒向随机微分方程 (BSDE) 速成</title>
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/highlight.css">
    <script src="./assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <ul class="nav-list"><li class=""><a href="./index.html">扩散模型教程</a></li><li class=""><a href="./chapter1.html">第1章：扩散模型导论</a></li><li class=""><a href="./chapter2.html">第2章：神经网络架构：U-Net与ViT</a></li><li class=""><a href="./chapter3.html">第3章：去噪扩散概率模型 (DDPM)</a></li><li class=""><a href="./chapter4.html">第4章：基于分数的生成模型</a></li><li class=""><a href="./chapter5.html">第5章：连续时间扩散模型 (PDE/SDE)</a></li><li class=""><a href="./chapter6.html">第6章：流匹配 (Flow Matching)</a></li><li class=""><a href="./chapter7.html">第7章：扩散Transformer (DiT)</a></li><li class=""><a href="./chapter8.html">第8章：采样算法与加速技术</a></li><li class=""><a href="./chapter9.html">第9章：条件生成与引导技术</a></li><li class=""><a href="./chapter10.html">第10章：潜在扩散模型 (LDM)</a></li><li class=""><a href="./chapter11.html">第11章：视频扩散模型</a></li><li class=""><a href="./chapter12.html">第12章：文本扩散模型</a></li><li class=""><a href="./chapter13.html">第13章：扩散模型的应用</a></li><li class=""><a href="./chapter14.html">第14章：前沿研究与未来方向</a></li><li class=""><a href="./appendix-a.html">附录A：测度论与随机过程速成</a></li><li class="active"><a href="./appendix-b.html">附录B：倒向随机微分方程 (BSDE) 速成</a></li><li class=""><a href="./appendix-c.html">附录C：信息几何与分数函数的力学解释</a></li><li class=""><a href="./CLAUDE.html">扩散模型教程项目说明</a></li><li class=""><a href="./PROJECT_STATUS.html">扩散模型教程项目状态</a></li><li class=""><a href="./README.html">扩散模型教程</a></li></ul>
        </nav>
        
        <main class="content">
            <article>
                <p><a href="appendix-a.html">← 附录A</a> | 附录B | <a href="appendix-c.html">附录C →</a></p>
<h1 id="b-bsde">附录B：倒向随机微分方程 (BSDE) 速成</h1>
<p>倒向随机微分方程（Backward Stochastic Differential Equations, BSDE）是理解扩散模型反向过程，特别是其与最优控制和经济学联系的重要数学工具。本附录将快速介绍BSDE的核心概念，旨在为读者提供一个更深刻的理论视角。</p>
<h2 id="b1">B.1 从前向到倒向：问题的提出</h2>
<p>标准的前向SDE（FSDE）从一个已知的初始状态 <code>X_0</code> 出发，描述系统如何演化到未来。然而，在许多问题中，我们关心的是一个“目标导向”的问题：给定一个在未来时刻 <code>T</code> 的目标（或成本）<code>ξ</code>，我们想知道在当前时刻 <code>t</code> 的“价值”<code>Y_t</code> 以及为了达到该目标需要采取的“策略”<code>Z_t</code>。</p>
<blockquote>
<p><strong>定义 B.1 (一般BSDE)</strong>
一个BSDE的解是一对随机过程 <code>(Y_t, Z_t)</code>，满足：
</p>
</blockquote>
<p>$$-dY_t = f(t, Y_t, Z_t)dt - Z_t dW_t$$</p>
<blockquote>
<p>并满足一个<strong>终端条件</strong> <code>Y_T = ξ</code>。</p>
</blockquote>
<p><strong>与FSDE的核心区别</strong>：</p>
<ul>
<li><strong>信息流向</strong>：FSDE由初始条件决定，向未来求解。BSDE由终端条件决定，向过去求解。</li>
<li><strong>解的构成</strong>：FSDE的解是一个过程 <code>X_t</code>。BSDE的解是一对过程 <code>(Y_t, Z_t)</code>。</li>
</ul>
<p><strong>直观理解 <code>Y_t</code> 和 <code>Z_t</code></strong>：</p>
<ul>
<li><strong><code>Y_t</code> (价值过程)</strong>: 代表在时刻 <code>t</code>，为了满足终端条件 <code>ξ</code> 所需的“价值”或“成本”。</li>
<li><strong><code>Z_t</code> (策略/对冲过程)</strong>: 代表在时刻 <code>t</code>，为了应对随机性 <code>dW_t</code> 而需要采取的“策略”或“控制”。在金融中，这对应于对冲组合；在扩散模型中，它与分数函数 <code>∇log p_t</code> 密切相关。</li>
</ul>
<h2 id="b2">B.2 核心理论</h2>
<h3 id="b21">B.2.1 存在唯一性</h3>
<p>BSDE理论的基石是由Pardoux和彭实戈在1990年证明的存在唯一性定理。</p>
<blockquote>
<p><strong>定理 B.2 (Pardoux-Peng, 1990)</strong>
如果终端条件 <code>ξ</code> 是平方可积的，且驱动函数 <code>f(t, y, z)</code> 关于 <code>y</code> 和 <code>z</code> 满足Lipschitz连续性，那么BSDE存在唯一的平方可积解 <code>(Y, Z)</code>。</p>
</blockquote>
<p>这个定理保证了我们讨论的问题是良定义的。后续的研究将条件放宽到了二次增长的驱动函数，这对于连接BSDE和某些物理或金融模型至关重要。</p>
<h3 id="b22">B.2.2 比较定理</h3>
<p>BSDE的一个强大性质是比较定理，它允许我们比较不同BSDE的解。
<strong>简而言之</strong>：如果一个BSDE的终端条件和驱动函数都“更大”，那么它的解 <code>Y_t</code> 在任何时刻 <code>t</code> 也都“更大”。这在风险度量和最优控制中非常有用。</p>
<h3 id="b23-bsdepdefeynman-kac">B.2.3 BSDE与PDE的联系：非线性Feynman-Kac公式</h3>
<p>BSDE与偏微分方程（PDE）之间存在深刻的对偶关系，这通过非线性Feynman-Kac公式建立。</p>
<p>🌟 <strong>理论核心</strong>：一个（半）线性抛物型PDE的解，可以表示为一个BSDE的解的期望。反之，一个BSDE的解 <code>Y_t</code> 也可以看作是某个PDE <code>u(t, X_t)</code> 沿着随机路径 <code>X_t</code> 的演化。具体来说，<code>Y_t = u(t, X_t)</code>，而 <code>Z_t</code> 与 <code>u</code> 的空间梯度 <code>∇u</code> 相关：<code>Z_t = σ^T * ∇u</code>。</p>
<p>这个联系是双向的：</p>
<ul>
<li>我们可以用概率方法（模拟BSDE）来求解高维PDE。</li>
<li>我们可以用PDE的理论来分析BSDE的性质。</li>
</ul>
<h2 id="b3-bsde">B.3 BSDE在扩散模型中的应用</h2>
<p>BSDE为连续时间扩散模型提供了严格的数学描述。</p>
<ol>
<li>
<p><strong>反向过程的刻画</strong>：扩散模型的反向过程，即从噪声 <code>x_T</code> 生成数据 <code>x_0</code> 的过程，本质上是一个终端值问题，可以用BSDE来精确描述。</p>
</li>
<li>
<p><strong>分数函数的演化</strong>：定义 <code>Y_t = log p_t(X_t)</code>，即沿着随机路径 <code>X_t</code> 的对数概率密度。可以证明，<code>Y_t</code> 满足一个驱动函数 <code>f</code> 具有二次增长的非线性BSDE。在这个BSDE中，<code>Z_t</code> 过程与分数函数 <code>∇log p_t(X_t)</code> 直接相关。</p>
<p>💡 <strong>关键洞察</strong>：这意味着，学习分数函数的过程，可以被看作是求解一个非线性BSDE的过程。这为设计新的损失函数和训练算法提供了理论依据。例如，我们可以通过最小化BSDE的残差来学习分数模型。</p>
</li>
<li>
<p><strong>与最优传输的联系</strong>：连接两个分布 <code>p_0</code> 和 <code>p_T</code> 的Schrödinger桥问题，可以被转化为求解一个耦合的前向-倒向SDE（FBSDE）系统。这个系统的解给出了在两个分布之间转换的最优随机路径，为扩散模型提供了最优传输的视角。</p>
</li>
</ol>
<h2 id="b4">B.4 数值方法简介</h2>
<p>由于大多数BSDE没有解析解，数值方法至关重要。</p>
<ul>
<li>
<p><strong>时间离散化</strong>：最常见的是向后欧拉格式。从 <code>Y_T = ξ</code> 开始，反向迭代求解 <code>(Y_{t_i}, Z_{t_i})</code>。每一步都需要计算一个条件期望，这是数值求解的难点。</p>
</li>
<li>
<p><strong>深度学习方法 (Deep BSDE)</strong>：现代方法使用神经网络来参数化未知的 <code>Z_t</code> 过程。其核心思想是：</p>
<ol>
<li>用一个神经网络 <code>Z_θ(t, x)</code> 来近似 <code>Z_t</code>。</li>
<li>从 <code>t=0</code> 开始，使用 <code>Z_θ</code> 和一个猜测的初始值 <code>Y_0</code>，通过离散化格式前向模拟出 <code>Y_T</code>。</li>
<li>最小化模拟得到的 <code>Y_T</code> 和真实的终端条件 <code>ξ</code> 之间的误差 <code>||Y_T - ξ||^2</code>。</li>
<li>通过反向传播训练网络参数 <code>θ</code> 和初始值 <code>Y_0</code>。</li>
</ol>
</li>
</ul>
<p>⚡ <strong>实现挑战</strong>：Deep BSDE方法将一个复杂的随机控制问题转化为了一个深度学习的优化问题，但在高维情况下，仍然面临“维度灾难”的挑战。</p>
<details>
<summary><strong>练习 B.1：线性BSDE的显式解</strong></summary>
<p>考虑线性BSDE：<code>-dY_t = (aY_t + f_t)dt - Z_t dW_t</code>，终端条件为 <code>Y_T = ξ</code>，其中 <code>a</code> 是常数，<code>f_t</code> 是确定性函数。</p>
<ol>
<li><strong>求解</strong>：使用积分因子 <code>e^{at}</code>，求解 <code>Y_t</code> 的表达式。</li>
<li><strong>分析</strong>：解释解的表达式的金融学含义（将 <code>a</code> 视为贴现率）。</li>
<li><strong>开放探索</strong>：如果 <code>a</code> 也是一个随机过程 <code>a_t</code>，解会是什么形式？这在随机利率模型中很常见。</li>
</ol>
<p><strong>解答思路</strong>：</p>
<ol>
<li>对 <code>tilde(Y)_t = e^{at}Y_t</code> 应用伊藤公式，可以消去 <code>Y_t</code> 的漂移项，得到一个只包含 <code>dt</code> 和 <code>dW_t</code> 的SDE。对其积分再整理，最终得到 <code>Y_t = E[e^{-a(T-t)}ξ + ∫_t^T e^{-a(s-t)}f_s ds | F_t]</code>。</li>
<li>这个解表示，时刻 <code>t</code> 的价值等于未来所有现金流 <code>f_s</code> 和终端价值 <code>ξ</code> 在考虑了贴现因子 <code>e^{-a(s-t)}</code> 后的条件期望。</li>
</ol>
</details>
<details>
<summary><strong>练习 B.2：BSDE与热方程</strong></summary>
<p>证明热方程 <code>∂u/∂t + 1/2 * Δu = 0</code>，<code>u(T,x) = g(x)</code> 的解可以用一个BSDE表示。</p>
<ol>
<li><strong>构造过程</strong>：定义一个前向过程 <code>X_t^x = x + W_t</code> 和一个新过程 <code>Y_t = u(t, X_t^x)</code>。</li>
<li><strong>应用伊藤公式</strong>：对 <code>Y_t</code> 应用伊藤公式。</li>
<li><strong>建立联系</strong>：利用 <code>u</code> 是热方程的解这一事实，证明 <code>Y_t</code> 满足一个驱动函数 <code>f=0</code> 的BSDE。</li>
</ol>
<p><strong>研究思路</strong>：这个练习展示了Feynman-Kac公式最简单的情形。思考一下，如果PDE中有一个非线性的项，例如 <code>∂u/∂t + 1/2 * Δu + (∇u)^2 = 0</code>（Hamilton-Jacobi-Bellman方程），那么对应的BSDE的驱动函数 <code>f</code> 会是什么样的？</p>
</details>
<h2 id="_1">本章小结</h2>
<ul>
<li><strong>核心定义</strong>：BSDE是从一个未来的终端条件出发，向后求解的随机微分方程，其解为一对 <code>(Y_t, Z_t)</code> 过程。</li>
<li><strong>理论基石</strong>：存在唯一性定理和比较定理保证了BSDE的良好性质。非线性Feynman-Kac公式建立了BSDE与PDE的深刻联系。</li>
<li><strong>扩散模型应用</strong>：BSDE为描述扩散模型的反向过程和分数函数的演化提供了严格的数学框架，并将其与最优控制和最优传输理论联系起来。</li>
</ul>
<p>虽然BSDE理论较为抽象，但它为我们理解“目标导向”的随机过程提供了统一而强大的语言，是连接概率论、PDE和机器学习的重要桥梁。</p>
            </article>
            
            <nav class="page-nav"><a href="./appendix-a.html" class="nav-link prev">← 附录A：测度论与随机过程速成</a><a href="./appendix-c.html" class="nav-link next">附录C：信息几何与分数函数的力学解释 →</a></nav>
        </main>
    </div>
</body>
</html>